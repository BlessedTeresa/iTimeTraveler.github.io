<!DOCTYPE html>
<html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init">
<head>
  <meta charset="utf-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>iTime</title>
  <link rel="stylesheet" href="../../../../css/style.css">
  <!--在这里倒入jquery 方便处理部分页面的jquery-->
  <script src="http://lib.sinaapp.com/js/jquery/1.9.0/jquery.min.js" type="text/javascript"></script>
</head>

<body>
	
  <header class="site-header navfixed-false">

  <div class="container">
      <h1><a href="../../../../index.html" title="iTime"><span class="octicon octicon-mark-github"></span> iTime</a></h1>
      <nav class="site-header-nav" role="navigation">
        
              
              <a href="../../../../index.html"  class=" site-header-nav-item hvr-underline-from-center" title="Home">Home</a>
        
              
              <a href="../../../../archives/"  class=" site-header-nav-item hvr-underline-from-center" title="Archives">Archives</a>
        
              
              <a href="../../../../tags/"  class=" site-header-nav-item hvr-underline-from-center" title="Tags">Tags</a>
        
              
              <a href="../../../../about/"  class=" site-header-nav-item hvr-underline-from-center" title="About">About</a>
        
      </nav>
  </div>
</header>

	
    <section class="collection-head geopattern" data-pattern-id="【Android】如何加速 AndroidStudio 的编译效率" >

    <div class="container">
        <div class="collection-title">
            <h1 class="collection-header">【Android】如何加速 AndroidStudio 的编译效率</h1>
            <div class="collection-info">
                <span class="meta-info">
                    
                        <span class="octicon octicon-calendar"></span>
                        <time datetime="2016-08-26T07:20:00.000Z" itemprop="datePublished">2016-08-26</time>
                    
                </span>
            </div>
        </div>
    </div>
</section>
	

    <section class="container">

    <div class="columns">
        <div class="column three-fourths" >
            <article class="article-content article-entry">
                <h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a><strong>引言</strong></h3><p>如果你之前用eclipse开发过Android app的话，转到android studio的第一反应也许就是：”<strong>编译速度有点慢</strong>“，表现的最明显的一点就是，每次android studio使用gradle编译，即便是更改的代码量很少，也会按照预先设置的task的顺序，依次走完编译的各项流程。这时候如果电脑CPU配置不高的时候，就会超级卡界面，更别说改代码了。</p>
<p>所以 这点就让人很痛苦， 然而问题总还是要被解决的，作者曾经亲眼看到过使用android studio仅仅用了2.5秒就编译完毕(在代码更改很少的情况下)。 现在把如何优化gradle编译速度的方法记录在此，希望可以 帮助到广大的同行们。</p>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a><strong>准备工作</strong></h3><p>首先，保证项目使用的Gradle是最新的，我这里用的是2.10版本。因为Gradle 2.4之后在编译效率上面有了一个非常大的提高，看下图官方的速度对比。</p>
<p><img src="http://img.blog.csdn.net/20160826151929475" alt="这是官方的速度对比，下一代编译速度更快"></p>
<a id="more"></a>
<p>然后先在你的项目build.gradle文件内(不是app里面的gradle文件), 就是这里：</p>
<p><img src="http://img.blog.csdn.net/20160826151521755" alt="配置文件在项目中的位置"></p>
<p>添加一个task， 代码如下:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><div class="line"><span class="keyword">task</span> wrapper(type: Wrapper) &#123;</div><div class="line">    gradleVersion = <span class="string">'2.10'</span>  <span class="comment">//你安装的最新Gradle版本</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>加进去以后是这个样子：</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span></div><div class="line"></div><div class="line"><span class="comment">// Running 'gradle wrapper' will generate gradlew - Getting gradle wrapper working and using it will save you a lot of pain.</span></div><div class="line"></div><div class="line"><span class="keyword">task</span> wrapper(type: Wrapper) &#123;</div><div class="line">    gradleVersion = <span class="string">'2.10'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">buildscript</span> &#123;</div><div class="line">    <span class="keyword">repositories</span> &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">dependencies</span> &#123;</div><div class="line">        <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:2.1.0'</span></div><div class="line">    &#125;</div><div class="line">    ext &#123;</div><div class="line">        compileSdkVersion = <span class="number">21</span></div><div class="line">        buildToolsVersion =<span class="string">"23.0.2"</span></div><div class="line">        minSdkVersion = <span class="number">18</span></div><div class="line">        targetSdkVersion = <span class="number">21</span></div><div class="line"></div><div class="line">        <span class="keyword">sourceCompatibility</span> = JavaVersion.VERSION_1_7</div><div class="line">        <span class="keyword">targetCompatibility</span> = JavaVersion.VERSION_1_7</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后打开terminal, 输入<code>./gradlew wrapper</code>，Windows 下输入：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">gradlew wrapper</div></pre></td></tr></table></figure>
<p>然后gradle就会自动去下载2.4版本,这也是官方推荐的<a href="http://gradle.org/docs/current/userguide/gradle_wrapper.html" target="_blank" rel="external"><strong>手动设置gradle的方法</strong></a></p>
<h3 id="守护进程，并行编译"><a href="#守护进程，并行编译" class="headerlink" title="守护进程，并行编译"></a><strong>守护进程，并行编译</strong></h3><p>通过以上步骤,我们设置好了 Android Studio 使用最新的 Gradle 版本，下一步就是正式开启优化之路了。我们需要将gradle作为守护进程一直在后台运行，这样当我们需要编译的时候，gradle就会立即跑过来然后 吭哧吭哧的开始干活。除了设置gradle一直开启之外，当你的工作空间存在多个project的时候，还需要设置gradle对这些projects并行编译，而不是单线的依次进行编译操作。</p>
<p>说了那么多， 那么怎么设置守护进程和并行编译呢？其实非常简单，gradle本身已经有了相关的配置选项，在你电脑的GRADLE_HOME这个环境变量所指的那个文件夹内，有一个.gradle/gradle.properties文件。 在这个文件里，放入下面两句话就OK了:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">org.gradle.daemon=true</div><div class="line">org.gradle.parallel=true</div></pre></td></tr></table></figure>
<p>有一个地方需要注意的是,android studio 本身在编译的时候,已经是使用守护进程中的gradle了,那么这里加上了org.gradle.daemon=true就是保证了你在使用命令行编译apk的时候也是使用的守护进程.</p>
<p>你也可以将上述的配置文件放到你project中的根目录下,以绝对确保在任何情况下,这个project都会使用守护进程进行编译.不过有些特殊的情况下也许你应该注意守护进程的使用,具体的细节参考官网<a href="http://gradle.org/docs/current/userguide/gradle_daemon.html#when_should_i_not_use_the_gradle_daemon" target="_blank" rel="external"><strong>When should I not use the Gradle Daemon?</strong></a></p>
<p>在使用并行编译的时候必须要注意的就是,你的各个project之间不要有依赖关系,否则的话,很可能因为你的Project A 依赖Project B, 而Project B还没有编译出来的时候,gradle就开始编译Project A 了.最终 导致编译失败.具体可以参考官网<a href="http://gradle.org/docs/current/userguide/multi_project_builds.html#sec:decoupled_projects" target="_blank" rel="external"><strong>Multi-Project Building and Testing</strong></a>。</p>
<p>还有一些额外的gradle设置也许会引起你的兴趣,例如你想增加堆内存的空间,或者指定使用哪个jvm虚拟机等等(代码如下)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">org.gradle.jvmargs=-Xmx768m</div><div class="line">org.gradle.java.home=/path/to/jvm</div></pre></td></tr></table></figure>
<p>如果你想详细的了解gradle的配置,请猛戳官网 <a href="http://gradle.org/docs/current/userguide/userguide_single.html#sec:gradle_configuration_properties" target="_blank" rel="external"><strong>Gradle User Guide</strong></a>。</p>
<h4 id="【参考资料】："><a href="#【参考资料】：" class="headerlink" title="【参考资料】："></a>【参考资料】：</h4><p>1、<a href="https://medium.com/@erikhellman/boosting-the-performance-for-gradle-in-your-android-projects-6d5f9e4580b6#.xkvoyii8g" target="_blank" rel="external">Boosting the performance for Gradle in your Android projects</a><br>2、<a href="http://www.devtf.cn/?p=585" target="_blank" rel="external">译文：优化android studio编译效率的方法</a><br>3、<a href="http://stackoverflow.com/questions/25769536/how-when-to-generate-gradle-wrapper-files" target="_blank" rel="external">How/when to generate Gradle wrapper files?</a></p>

            </article>
            
                <div class="share">
                    <!--开启分享-->
<div class="share-component"></div>

<script src="../../../../js/share.min.js"></script>
                </div>    
            
            
                <div class="comment">
                    
<div class="ds-thread" data-thread-key="【Android】如何加速 AndroidStudio 的编译效率" data-title="【Android】如何加速 AndroidStudio 的编译效率" data-url="http://github.com"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"iTimeTraveler"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>
                </div>
            
        </div>
        <div class="column one-fourth">
            
                <h3>Post Directory</h3>

<div id="post-directory-module">
	<section class="post-directory">
		<p><strong class="toc-title">文章目录</strong></p>
		<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#引言"><span class="toc-text">引言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#准备工作"><span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#守护进程，并行编译"><span class="toc-text">守护进程，并行编译</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#【参考资料】："><span class="toc-text">【参考资料】：</span></a></li></ol></li></ol>
	</section>
</div>
            
        </div>
       
    </div>
</section>

<footer class="container">
    <div class="site-footer" role="contentinfo">
        <div class="copyright left mobile-block">
                © 2016
                <span title="yumemor">yumemor</span>
                <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a>
        </div>

        <ul class="site-footer-links right mobile-hidden">
            <li>
                <a href="javascript:window.scrollTo(0,0)" >TOP</a>
            </li>
        </ul>

        <a href="https://github.com/iTimeTraveler/iTimeTraveler.github.io" target="_blank" aria-label="view source code">
            <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
        </a>

        <ul class="site-footer-links mobile-hidden">
            
             
              
              <li>
                <a href="../../../../index.html"  title="Home">Home</a>
              </li>
            
              
              <li>
                <a href="../../../../archives/"  title="Archives">Archives</a>
              </li>
            
              
              <li>
                <a href="../../../../tags/"  title="Tags">Tags</a>
              </li>
            
              
              <li>
                <a href="../../../../about/"  title="About">About</a>
              </li>
            

        </ul>

    </div>
</footer>

		
		<script src="../../../../js/typer.js"></script>

		<script src="../../../../js/geopattern.js"></script>

		<script src="../../../../js/index.js"></script>

		 <script src="../../../../js/popular_repo.js"></script> 

	</body>
</html>